---
interface Metric {
  icon: string;
  metric: string;
  description: string;
}
interface SuccessCase {
  videoUrl: string;
  metrics: Metric[];
}

const cases: SuccessCase[] = [
  {
    videoUrl:
      "https://player.vimeo.com/video/1099474062?h=3bcd9d4cd4&badge=0&autopause=0&player_id=0&app_id=58479",
    metrics: [
      {
        icon: "📈",
        metric: "2482 seguidores",
        description: "@soymarisolguillen",
      },
      {
        icon: "🚀",
        metric: "Más de 1600 seguidores",
        description: "Luego de finalizar la academia.",
      },

      {
        icon: "🎯",
        metric: "Su video más viral: ",
        description:
          "74 mil vistas, 672 likes, 66 comentarios y 154 compartidos.",
      },
    ],
  },
  {
    videoUrl:
      "https://player.vimeo.com/video/1099507223?h=4afe8e5aef&badge=0&autopause=0&player_id=0&app_id=58479",
    metrics: [
      {
        icon: "📈",
        metric: "1377 seguidores",
        description: "@wanderwhitemma_",
      },
      {
        icon: "🚀",
        metric:
          "Ha logrado colaborar con hoteles y marcas de skincare en Estados Unidos.",
        description: "Luego de finalizar la academia.",
      },

      {
        icon: "🎯",
        metric: "Su video más viral: ",
        description: "4597 vistas, 135 likes, 16 comentarios y 5 compartidos.",
      },
    ],
  },
  {
    videoUrl:
      "https://player.vimeo.com/video/1099733180?h=fff8bf4e63&badge=0&autopause=0&player_id=0&app_id=58479",
    metrics: [
      {
        icon: "📈",
        metric: "882 seguidores",
        description: "@rebecacolantuoning",
      },
      {
        icon: "🚀",
        metric: "Dueña de @beka_beauty.cl",
        description: "Luego de finalizar la academia.",
      },

      {
        icon: "🎯",
        metric: "Su video más viral: ",
        description: "84,1 mil, 152 likes, 36 comentarios y 45 compartidos.",
      },
    ],
  },
  {
    videoUrl:
      "https://player.vimeo.com/video/1100010427?h=7288b1ee92&badge=0&autopause=0&player_id=0&app_id=58479",
    metrics: [
      {
        icon: "📈",
        metric: "38,5 mil seguidores",
        description: "@leorojasr",
      },
      {
        icon: "🚀",
        metric: "Hoy, nos muestra su primera colaboración con una marca",
        description: "Luego de finalizar la academia.",
      },

      {
        icon: "🎯",
        metric: "Su crecimiento en TikTok: ",
        description: "Subió más de 2mil seguidores en TikTok.",
      },
    ],
  },
];
---

<section class="py-20 bg-black relative overflow-hidden">
  <div class="container mx-auto px-4 relative z-10">
    <div class="text-center mb-12">
      <h2 class="text-2xl md:text-3xl lg:text-4xl font-bold text-white mb-4">
        Historias de Éxito y Resultados Reales
      </h2>
      <div class="w-24 h-1 bg-secondary mx-auto"></div>
    </div>

    <div id="carousel-cases" class="relative">
      {
        cases.map((c, idx) => (
          <div
            class={`grid lg:grid-cols-2 gap-12 items-stretch carousel-case ${idx === 0 ? "active" : ""}`}
            data-index={idx}
          >
            <div class="order-1 lg:order-2 flex items-center">
              <div class="space-y-6 w-full">
                {c.metrics.map((metric) => (
                  <div class="fade-in card-hover bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20 flex items-center">
                    <div class="text-4xl">{metric.icon}</div>
                    <div class="ml-4">
                      <div class="text-2xl font-bold text-white">
                        {metric.metric}
                      </div>
                      <p class="text-white/90">{metric.description}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div class="order-2 lg:order-1 flex justify-center">
              <div class="fade-in card-hover bg-white/10 backdrop-blur-sm rounded-2xl border border-white/20 flex items-center max-w-[360px] w-full mx-auto">
                <div class="relative w-full aspect-[9/16] rounded-xl overflow-hidden mx-auto">
                  <iframe
                    src={
                      idx === 0
                        ? `${c.videoUrl}${c.videoUrl.includes("?") ? "&" : "?"}autoplay=1&muted=1`
                        : c.videoUrl
                    }
                    class="w-full h-full"
                    frameborder="0"
                    allow="autoplay; fullscreen; picture-in-picture"
                    allowfullscreen
                    title="Caso de Éxito"
                  />
                </div>
              </div>
            </div>
          </div>
        ))
      }

      <!-- Arrows -->
      <button
        id="prevBtn"
        type="button"
        class="carousel-prev absolute left-4 top-[70%] -translate-y-1/2 z-30 w-10 h-10 rounded-full bg-white/60 text-secondary text-xl flex items-center justify-center hover:bg-secondary hover:text-white shadow-lg"

        aria-label="Anterior">←</button
      >
      <button
        id="nextBtn"
        type="button"
        class="carousel-next absolute right-4 top-[70%] -translate-y-1/2 z-30 w-10 h-10 rounded-full bg-white/60 text-secondary text-xl flex items-center justify-center hover:bg-secondary hover:text-white shadow-lg"
        aria-label="Siguiente">→</button
      >

      <!-- Dots -->
      <div class="flex justify-center gap-2 mt-4" id="carousel-dots">
        {
          cases.map((_, idx) => (
            <span
              class={`inline-block w-3 h-3 rounded-full ${idx === 0 ? "bg-secondary" : "bg-white/20"}`}
              data-dot={idx}
            />
          ))
        }
      </div>
    </div>
  </div>
</section>

<script>
  let current = 0;
  let timer = null;

  const cases = Array.from(document.querySelectorAll(".carousel-case"));
  const dots = Array.from(document.querySelectorAll("[data-dot]"));

  function showCase(idx) {
    cases.forEach((el, i) => {
      const iframe = el.querySelector("iframe");
      if (iframe && i !== idx) iframe.src = iframe.src;
      el.classList.toggle("active", i === idx);
    });
    dots.forEach((el, i) => {
      el.classList.toggle("bg-secondary", i === idx);
      el.classList.toggle("bg-white/20", i !== idx);
    });
    current = idx;
    resetTimer();
  }

  function resetTimer() {
    if (timer) clearInterval(timer);
    timer = setInterval(() => showCase((current + 1) % cases.length), 30000);
  }

  setTimeout(() => {
    document.getElementById("prevBtn").onclick = () =>
      showCase((current - 1 + cases.length) % cases.length);
    document.getElementById("nextBtn").onclick = () =>
      showCase((current + 1) % cases.length);
    dots.forEach((el, i) => (el.onclick = () => showCase(i)));
    resetTimer();
  }, 100);
</script>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }
  .carousel-case {
    transition: opacity 0.5s;
    opacity: 0;
    pointer-events: none;
    position: absolute;
    width: 100%;
    left: 0;
    top: 0;
  }
  .carousel-case.active {
    opacity: 1;
    pointer-events: auto;
    position: relative;
    z-index: 1;
  }
</style>
